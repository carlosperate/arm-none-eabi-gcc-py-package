# GNU Arm Embedded Toolchain Python Package

This project repackages the GNU Arm Embedded Toolchain from the
[Arm Developer website](https://developer.arm.com/downloads/-/arm-gnu-toolchain-downloads)
into a Python package that can be easily installed via pip.

The resulting Python package includes the full toolchain and adds its binaries
to the Python environment path.

## Current project state

> [!CAUTION]
> This is still a work-in-progress, the package is not yet available on PyPI,
> and any pre-release versions installed right now might be broken.

There is currently a simple repository with the package available at
https://carlosperate.github.io/arm-none-eabi-gcc-py-package.

To install the package using this repository:
```
pip install arm-none-eabi-gcc-toolchain --extra-index-url https://carlosperate.github.io/arm-none-eabi-gcc-py-package
```

And all the GNU Arm Embedded Toolchain binaries will be available in the path:
```
$ which arm-none-eabi-gcc
(...)/.venv/bin/arm-none-eabi-gcc

$ arm-none-eabi-gcc --version
arm-none-eabi-gcc (Arm GNU Toolchain 13.3.Rel1 (Build arm-13.24)) 13.3.1 20240614
Copyright (C) 2023 Free Software Foundation, Inc.
This is free software; see the source for copying conditions.  There is NO
warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
```

### TODO

- [ ] Use or fork [wheel-stub](https://github.com/wheel-next/wheel-stub/) to
  publish source packages to PyPI that pull these wheels externally hosted
- [ ] Keep an eye on [PEP 759 – External Wheel Hosting](https://peps.python.org/pep-0759/)

## Versions

| GCC Version  | Python Package Version | Win x86_64 | Linux x86_64 | Linux aarch64 |  macOS x86_64 | macOS arm64 |
|--------------|------------------------|------------|--------------|---------------|---------------|-------------|
| 13.3.Rel1    | 13.3.*                 | ✅ | ✅ | ✅ | ✅ | ✅ |
| 13.2.Rel1    | 13.2.*                 | ✅ | ✅ | ✅ | ✅ | ✅ |
| 12.3.Rel1    | 12.3.*                 | ✅ | ✅ | ✅ | ✅ | ✅ |
| 12.2.Rel1    | 12.2.*                 | ✅ | ✅ | ✅ | ✅ | ✅ |
| 11.3.Rel1    | 11.3.*                 | ✅ | ✅ | ✅ | ✅ | ❌ |
| 11.2-2022.02 | 11.2.*                 | ✅ | ✅ | ✅ | ✅ | ❌ |
| 10.3-2021.10 | 10.3.*                 | ✅ | ✅ | ✅ | ✅ | ❌ |
| 10-2020-q4   | 10.2.*                 | ✅ | ✅ | ✅ | ✅ | ❌ |
| 9-2020-q2    | 9.3.*                  | ✅ | ✅ | ✅ | ✅ | ❌ |
| 9-2019-q4    | 9.2.*                  | ✅ | ✅ | ✅ | ✅ | ❌ |

### Versioning scheme

The package version follows `MAJOR.MINOR.PATCH` format, but it combines the
GCC version and the `package_builder` versions, where:
- MAJOR version is the GCC major version
- MINOR version is the GCC minor version
- PATCH version is a single number indicating the version of `package_builder`
  used to create the package

So for example:

```
13 . 3 . 1
└──┬──┘ └┬┘
   │     └──── package_builder version
   └────────── GCC major.minor version
```

This allows version locking to a specific GCC version and be able to fetch the
latest `package_builder` (which might include bug fixes in the packaging),
e.g. `~=13.3`/`==13.3.*`.

## Project/repository structure

There are multiple folders in this repository to serve different aspects of
this package creation and distribution:

- `arm-none-eabi-gcc-toolchain`: Contains the skeleton code for the Python
  package source code, the rest of the package data is generated by
  `package_builder`.
- `package_builder`: Contains the Python scripts used to generate the 
  complete `arm-none-eabi-gcc-toolchain` packages (which are later
  uploaded to GH releases via CI).
- `.github/workflows/release.yml`: Contains the GitHub Actions workflow used
  to build and upload the wheels into to GitHub Releases in this repository.
- `simple_repository_regenerator`: Contains the Python scripts used to
  generate the static simple repository that points to the wheels stored
  in the GH Releases.
- `.github/workflows/publish_repository.yml`: Contains the GitHub Actions
  workflow used to publish the generated simple repository to GitHub Pages.

## Building the package

The `package_builder` folder contains the Python scripts needed to build
the package.

This script downloads an Arm GCC release, extracts it within the
`arm-none-eabi-gcc-toolchain` package folder, creates the additional Python
files required for the package, and builds it.

Install the builder dependencies (it's recommended to use a virtual environment):

```bash
pip install -r requirements.txt
```

Run the builder:

```bash
python -m package_builder build --release <name_of_release> --os <operating system> --arch <cpu architecture>
```

Options are:
- `--release`: The GCC release name as shown in the [versions section](#versions)
- `--os`: `linux`, `mac`, or `win`
- `--arch`: `x86_64` or `aarch64`/`arm64`

## Building the Simple Repository

The `simple_repository_regenerator` folder contains the Python scripts
used to generate a [PEP 503](https://peps.python.org/pep-0503/) and
[PEP 629](https://peps.python.org/pep-0629/) compliant (it does **not**
implement [PEP 691](https://peps.python.org/pep-0691/) JSON format)
static HTML python package repository site that points to the wheels
stored in the GitHub Releases from this repository.

To generate the HTML output, run the following command:

```bash
python -m simple_repository_generator "carlosperate/arm-none-eabi-gcc-py-package"
```

## License

All the source code in this repository is licensed under the MIT license.
The generated wheels contain the GNU Arm Embedded Toolchain,
which is licensed under the GPL v3 license.
